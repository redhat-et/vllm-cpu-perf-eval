---
# Example: AWS EC2 Deployment Configuration
# Use this when testing on dedicated AWS EC2 instances
#
# Setup:
# 1. Copy this file to inventory/hosts.yml
# 2. Update the IP addresses and SSH key paths
# 3. Ensure security groups allow port 8000 (vLLM) between instances
# 4. Run: ansible-playbook -i inventory/hosts.yml playbooks/...

all:
  vars:
    # Common connection settings
    ansible_user: ec2-user                           # Amazon Linux 2 / RHEL
    # ansible_user: ubuntu                           # Ubuntu AMI
    ansible_ssh_private_key_file: ~/.ssh/aws-key.pem  # ⚠️ Your SSH key path

    # AWS-specific overrides
    benchmark_tool:
      guidellm:
        # Use x86_64 container image (not ARM)
        container_image: "localhost/guidellm:latest"
        # Adjust CPU allocation based on your EC2 instance type
        cpuset_cpus: "16-31"  # Example: c6i.8xlarge has 32 vCPUs

      vllm_bench:
        # Use x86_64 vLLM image
        container_image: "quay.io/mtahhan/vllm:0.14.0"  # or vllm/vllm-openai:latest
        num_prompts: 1000  # Production-grade measurements

    # Optional: External endpoint mode for testing managed vLLM services
    # vllm_endpoint:
    #   mode: "external"
    #   external:
    #     url: "http://vllm-lb-12345.us-east-1.elb.amazonaws.com:8000"
    #     api_key:
    #       enabled: true
    #       source: "env"
    #       env_var: "VLLM_API_KEY"

  children:
    # DUT - EC2 instance running vLLM server
    dut:
      hosts:
        vllm-server:
          # Use private IP if in same VPC (faster, no NAT), otherwise public IP
          ansible_host: 10.0.1.100                   # ⚠️ Change to your DUT IP

    # Load Generator - EC2 instance running benchmarks
    load_generator:
      hosts:
        guidellm-client:
          # Can be same or different EC2 instance
          ansible_host: 10.0.1.101                   # ⚠️ Change to your load gen IP

      vars:
        # Benchmark configuration
        bench_config:
          # Automatically references DUT's IP (no duplication!)
          # Override only if you need to use a different IP (e.g., public IP for benchmarking)
          vllm_host: "{{ hostvars['vllm-server']['ansible_host'] }}"
          vllm_port: 8000
          results_dir: /home/ec2-user/benchmark-results
