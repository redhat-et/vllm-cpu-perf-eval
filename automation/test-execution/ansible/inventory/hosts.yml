---
# ============================================================================
# vLLM Performance Testing - Main Inventory File
# ============================================================================
#
# QUICK START - Two Options:
#
# Option 1: Environment Variables (Recommended - No file edits needed)
#   export DUT_HOSTNAME=your-dut-hostname-or-ip
#   export LOADGEN_HOSTNAME=your-loadgen-hostname-or-ip
#   export ANSIBLE_SSH_USER=ec2-user                    # Optional
#   export ANSIBLE_SSH_KEY=~/.ssh/your-key.pem          # Optional
#   export HF_TOKEN=hf_xxxxx                            # If using gated models
#
# Option 2: Edit this file directly
#   1. Update the two IP addresses:
#      - Line 50: vLLM server (DUT) IP
#      - Line 59: Load generator IP (same or different machine)
#      Note: vllm_host (where GuideLLM connects) auto-references the DUT IP
#   2. Update ansible_user and ansible_ssh_private_key_file if different
#   3. Set HF_TOKEN environment variable (if using gated models): export HF_TOKEN=hf_xxxxx
#   4. Run tests!
#
# Configuration files are now organized in group_vars/ directory:
#   - group_vars/all/infrastructure.yml  - Platform and container settings
#   - group_vars/all/endpoints.yml       - vLLM server and endpoint mode
#   - group_vars/all/benchmark-tools.yml - GuideLLM and vllm_bench config
#   - group_vars/all/credentials.yml     - HuggingFace token setup
#   - group_vars/all/test-workloads.yml  - Test configurations
#   - group_vars/all/hardware-profiles.yml - CPU/NUMA templates
#
# See inventory/README.md for detailed documentation
# ============================================================================

# ============================================================================
# HOST CONFIGURATION - ⚠️ CHANGE THESE VALUES ⚠️
# ============================================================================

all:
  vars:
    # Common connection settings (override per-host if needed)
    # Uses environment variables with fallback to default values
    ansible_user: "{{ lookup('env', 'ANSIBLE_SSH_USER') | default('ec2-user', true) }}"
    ansible_ssh_private_key_file: "{{ lookup('env', 'ANSIBLE_SSH_KEY') | default('~/.ssh/id_rsa', true) }}"

  children:
    # DUT (Device Under Test) - Runs vLLM server
    dut:
      hosts:
        vllm-server:
          # ⚠️ CHANGE: Your vLLM server IP or hostname
          # Or set DUT_HOSTNAME environment variable
          ansible_host: "{{ lookup('env', 'DUT_HOSTNAME') | default('192.168.1.10', true) }}"

    # Load Generator - Runs GuideLLM benchmarking tool
    load_generator:
      hosts:
        guidellm-client:
          # ⚠️ CHANGE: Your load generator IP or hostname
          # Or set LOADGEN_HOSTNAME environment variable
          # For separate machines: Use different IP from DUT
          # For same machine: Use same IP as DUT
          ansible_host: "{{ lookup('env', 'LOADGEN_HOSTNAME') | default('192.168.1.20', true) }}"

      vars:
        # Benchmark configuration
        bench_config:
          # Automatically uses the DUT's ansible_host
          # Override here if you need different IPs (e.g., private IP for benchmarking)
          vllm_host: "{{ hostvars['vllm-server']['ansible_host'] }}"
          vllm_port: 8000

          # Results storage location on load generator
          results_dir: "{{ lookup('env', 'HOME') }}/benchmark-results"

# ============================================================================
# COMMON DEPLOYMENT SCENARIOS
# ============================================================================
#
# 1. SEPARATE MACHINES (Default - No changes needed):
#    - Set DUT ansible_host (line 41)
#    - Set Load Gen ansible_host (line 50)
#    - vllm_host automatically references DUT IP
#
# 2. SAME MACHINE (Override vllm_host for localhost):
#    - Set both ansible_host to same IP
#    - Override vllm_host in bench_config:
#      bench_config:
#        vllm_host: localhost  # Faster than external IP
#
# 3. PRIVATE IP OPTIMIZATION (Same VPC):
#    - SSH via public IPs (ansible_host)
#    - Override vllm_host to use private IP for benchmarking:
#      bench_config:
#        vllm_host: 10.0.1.100  # DUT's private IP (faster in VPC)
#
# ============================================================================

# ============================================================================
# USAGE EXAMPLES
# ============================================================================
#
# Using Environment Variables (Recommended):
#
# 1. Set connection variables:
#    export DUT_HOSTNAME=your-dut-ip-or-hostname
#    export LOADGEN_HOSTNAME=your-loadgen-ip-or-hostname
#    export ANSIBLE_SSH_USER=ec2-user
#    export ANSIBLE_SSH_KEY=~/.ssh/your-key.pem
#    export HF_TOKEN=hf_xxxxx  # If using gated models
#
# 2. Test Ansible connectivity:
#    ansible -i inventory/hosts.yml all -m ping
#
# 3. Run platform setup (one-time, requires reboot):
#    ansible-playbook -i inventory/hosts.yml setup-platform.yml
#    ansible -i inventory/hosts.yml all -b -m reboot
#
# 4. Run LLM benchmark:
#    ansible-playbook -i inventory/hosts.yml \
#      llm-benchmark-auto.yml \
#      -e "test_model=Qwen/Qwen2.5-3B-Instruct" \
#      -e "workload_type=chat" \
#      -e "requested_cores=16"
#
# ============================================================================
